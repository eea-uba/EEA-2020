---
title: "Regresión Lineal Simple: Evaluación y Diagnóstico"
author: "Juan Barriola y Sofía Perini"
date: "26 de Septiembre de 2020"
output:
  html_document:
    df_print: paged
    toc: yes
    toc_float: yes
---

<style type="text/css">
div.main-container {
  max-width: 1600px;
  margin-left: auto;
  margin-right: auto;
}
</style>


**Encuesta de Sueldos en el sector IT**

## Planteo del problema

Vamos a continuar trabajando con el dataset de la encuesta de sueldos en el sector de tecnología en Argenina realizada por SysArmy. El informe, realizado por OpenQube lo pueden ver [acá](https://sueldos.openqube.io/encuesta-sueldos-2020.01/).

El objetivo es crear un modelo lineal simple para explicar el sueldo neto de los Data Analysts, Data Scientists y Data Engineers en Argentina.

La idea subyacente de cómo se puede explicar el salario neto es:

$salarioNeto = \beta_0 +\beta_1X+\epsilon$

## Dataset y Modelos

```{r, message=FALSE}
# Carga de librerías
library(tidyverse)
library(tidymodels)
```

En el notebook previo realizamos un análisis extenso de nuestro dataset, limpieza de los datos y algunos modelos para explicar el salario.

```{r}
# Cargamos el dataset limpio
encuesta_sueldos = read_csv("~/Fuentes/encuesta_sueldos_it_limpia.csv")
```

Habíamos realizado tres modelos distintos para tratar de explicar el salario neto

  * **Modelo Edad**

  * **Modelo Años de experiencia**

  * **Modelo Años en la Empresa Actual**
  
Volvemos a realizar estos modelos:

```{r}
# Modelo Edad
modelo_edad = lm(formula = salario_neto ~ edad, data = encuesta_sueldos)
# Modelo experiencia
modelo_experiencia = lm(formula = salario_neto ~ anos_de_experiencia, data = encuesta_sueldos)
# Modelo empresa
modelo_empresa = lm(formula = salario_neto ~ anos_en_la_empresa_actual, data = encuesta_sueldos)
```

En el notebook previo sólo habíamos interpretado el valor de los parámetros estimados. Ahora buscaremos responder preguntas tales como:

  * ¿La relación entre la variable dependiente e independiente es estadísticamente significativa?
  * ¿Qué proporción de la variabilidad logra explicar el modelo? ¿Cómo decidir que modelo explica mejor el fenómeno?
  * ¿El modelo cumple con los supuestos del modelo lineal?

## Tidymodels: Broom

[Tidymodels](https://www.tidymodels.org/) es un meta-paquete (al igual que `tidyverse`) que contiene varios paquetes muy útiles para crear un framework para trabajar con modelos.

El paquete [broom](https://broom.tidymodels.org/) permite acceder a información de modelos e interactuar con los mismos de una manera sencilla. Las tres funciones para interactuar con los modelos son:

  * `tidy()`: resume información sobre los componentes del modelo
  * `glance()`: reporta información sobre todo el modelo
  * `augment()`: agrega información de las observaciones según el modelo al dataset
  
Veremos cómo utilizar estas funciones con un modelo lineal

## Evaluación del modelo

La función `summary()` nos permite obtener mucha información sobre el modelo lineal:

```{r}
resumen_modelo_edad = summary(modelo_edad)
resumen_modelo_edad
```

Observamos que hay información sobre:

  * Inferencia de $\beta_0$ y $\beta_1$
  * Estimación de $\sigma^2$
  * El coeficiente $R^2$
  * Los residuos del modelo
  
En las secciones subsiguientes vamos a desarrollar cada uno de estos aspectos

### Inferencia de $\beta_1$

En la salida de `summary()`, en la parte de **coefficients** observamos que están las columnas: estimate, std error, t value y Pr(>|t|).
En las filas se encuentra el intercepto y la variable independiente: **edad**.

En el notebook anterior trabajamos sobre la interpretación del coeficiente estimado (estimate). Ahora nos focalizaremos en la columnas t value y Pr(>|t|).

En la inferencia de $\beta_1$ nos interesa responder si la relación entre la variable independiente y la variable a explicar es estadísticamente significativa. Nuestro test de hipótesis es:

$H_0 : \beta_1 = 0$

$H_1 : \beta_1 \neq 0$

El valor de **t value** nos indica el valor del estadístico T para este test.

El valor de **Pr(>|t|)** nos indica el p-valor para dicho test, acompañado de una ayuda visual sobre los niveles de significancia.

Como el p-valor es extremadamente pequeño concluimos que se rechaza la hipótesis nula, es decir, $\beta_1$ (parámetro poblacional) es distinto de cero.

#### Broom: tidy

Con la función `tidy()` del paquete broom podemos obtener la información sobre los parámetros como un dataframe: 

```{r}
tidy(modelo_edad)
```

### Coeficiente de determinación $R^2$

El $R^2$ permite medir el porcentaje de variabilidad del fenómeno que el modelo logra explicar.  

```{r}
resumen_modelo_edad
```

El valor de $R^2$ es `r resumen_modelo_edad$r.squared`


```{r}
glance(modelo_edad)
```







