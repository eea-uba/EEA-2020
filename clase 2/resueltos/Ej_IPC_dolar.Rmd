---
title: "Ejercicio Tidyverse"
output: html_notebook
---

```{r}
#Librerias
library(tidyverse)
library(lubridate)
```

### Dólar

1. Leer el dataset

Realizamos la lectura de los datasets y miramos su estructura

```{r}
dolar = read_csv(file='~/EEA-2020/Fuentes/dolar_oficial_ambito.csv')
glimpse(dolar)
```

2. Crear la variable cotización_promedio, realizando el promedio entre compra y venta para cada día

```{r}
dolar = dolar %>% mutate(cotizacion_promedio = (compra + venta)/2)
glimpse(dolar)
```

3. Convertir la variable fecha de string a datetime. Crear las variables de año, mes y día 

```{r}
dolar = dolar %>% mutate(fecha=dmy(fecha), año=year(fecha), mes=month(fecha),
                         dia=day(fecha))
glimpse(dolar)
```

4. Graficar la evolución diaria de la cotización promedio

```{r}
ggplot(dolar, aes(x=fecha, y=cotizacion_promedio,)) +
  geom_line(color="forestgreen", size=1) +
  labs(x="Fecha", y="Tipo de cambio oficial", title="Evolución del tipo de cambio oficial")+
  theme_bw()
```

5. Calcular la mediana de la cotización promedio para cada año y mes (esta será la cotización mensual del dólar oficial)

```{r}
dolar_mensual = dolar %>% group_by(año, mes) %>% summarise(cotizacion_mensual = median(cotizacion_promedio))
glimpse(dolar_mensual)
```


### IPC

1. Leer el dataset 

```{r}
ipc = read_csv('~/EEA-2020/Fuentes/ipc-mensual.csv')
glimpse(ipc)
```

2. Modificar el dataset para que cumpla con la definición de tidy data: cada variable debe ser una columna (Apertura, Fecha e Indice). *Pista*: piensen si tienen que usar $spread$ o $gather$

```{r}
ipc = ipc %>% pivot_longer(-Apertura, names_to = "fecha", values_to = "indice")
glimpse(ipc)
```

3. Crear las variables fecha, año, mes y día

```{r}
ipc = ipc %>% mutate(fecha=ymd(parse_date_time(fecha, orders = 'my')),
                    año=year(fecha), mes=month(fecha))
glimpse(ipc)
```

4. Graficar la evolución del nivel general del IPC

```{r}
ipc %>% filter(Apertura== "Nivel general") %>% 
ggplot(., aes(x= fecha, y = indice)) +
  geom_point(color="firebrick")+
  geom_line(size= 1,alpha=0.75, color = "firebrick")+
  labs(x="Fecha", y="IPC", title="Evolución del IPC")+
  theme_bw()
```

5. Graficar la evolución de los 4 grupos

```{r}
ggplot(ipc, aes(x= fecha, y = indice, group = Apertura, color = Apertura )) +
  geom_point()+
  geom_line(size=1,alpha=0.75)+
  labs(x="Fecha", y="IPC", title="Evolución del IPC por grupo")+
  theme_bw()+
  scale_color_brewer(palette = "Set1")
```

### IPC y Dolar 

1. Realizar un join de ambos conjuntos de datos (dólar mensual e IPC) de manera que queden los meses para los cuáles hay datos de ambas variables 

Utilizamos un inner join ya que solo queremos quedarnos con los meses para los cuales tenemos información del IPC y del dólar.

```{r}
ipc_dolar = ipc %>% inner_join(dolar_mensual, by=c('año', 'mes'))
glimpse(ipc_dolar)
```

```{r}
ipc_dolar = ipc_dolar %>% mutate(indice_dolar = cotizacion_mensual * 100 / 15.9300)
```


2. Calcular la media, el desvío estándar, la mediana y el rango del dólar y del IPC General para cada uno de los años

Realizamos algunas estadísticas descriptivas por año y mes para el IPC general y para el tipo de cambio

```{r}
resumen=ipc_dolar %>% filter(Apertura=="Nivel general") %>%
              group_by(año) %>% 
              summarise(dolar_promedio=mean(cotizacion_mensual),
                        desvio_dolar=sd(cotizacion_mensual),
                        mediana_dolar=median(cotizacion_mensual),
                        rango_dolar=max(cotizacion_mensual)-min(cotizacion_mensual),
                        ipc_promedio=mean(indice),
                        desvio_ipc=sd(indice),
                        mediana_ipc=median(indice),
                        rango_ipc=max(indice)-min(indice))

resumen
```

3. Graficar la evolución del dólar y del nivel general del IPC (tener en cuenta el rango de las variables)

Como los rangos de las variables son muy diferentes, tenemos que utilizar un segundo eje.

```{r}
ggplot()+
  geom_line(data = ipc_dolar %>% filter(Apertura=="Nivel general"),aes(x=fecha,y=indice, color ="Nivel general"))+
  geom_line(data = ipc_dolar,aes(fecha,indice_dolar, color ="Dolar"))+
  labs(x="Fecha", y="IPC", title="Evolución del IPC y Dolar")+
  theme_bw()+
  scale_y_continuous(sec.axis = sec_axis(~., name = "Dolar"))

```

4. Graficar la evolución del dólar y de los 4 grupos de IPC


```{r}
ggplot()+
  geom_line(data = ipc_dolar,aes(fecha,indice))+
  geom_line(data = ipc_dolar,aes(fecha,indice_dolar, color ="Dolar"))+
  scale_y_continuous(sec.axis = sec_axis(~., name = "Dolar"))+
  scale_colour_manual("Color",values=c("darkgreen"))+
  theme_bw()+
  labs(x="Fecha", y="IPC", title="Evolución del IPC y Dolar por grupo")+
  facet_wrap(.~Apertura)

```

