---
title: "Regresión Lineal Simple"
author: "Juan Barriola y Sofía Perini"
date: "19 de Septiembre de 2020"
output:
  html_notebook:
    theme: spacelab
    toc: yes
    toc_float: yes
    df_print: paged
---

# Encuesta de Sueldos en el sector IT

Vamos a trabajar con un dataset de openqube^[https://openqube.io/encuesta-sueldos-2020.01#Introduccion%20%20%20https://docs.google.com/spreadsheets/d/e/2PACX-1vTORpz5hc_wOwKdaKEIgVOAI3XVTh9WXB__C2abe_E0aJoYIoqhWQ-HTpBBryAByhIlX_booioqxK0T/pub?gid=1893349211&single=true&output=csv] sobre empleos en el sector IT.

```{r}
library(data.table)
library(tidyverse)
library(readxl)
encuesta <- read_csv("../Fuentes/Encuesta de remuneracion salarial - 2020.1.csv")
encuesta %>%
  glimpse()
encuesta %>%
  head(10)

unique(encuesta$`Estoy trabajando en`) # solo Argentina aparece
unique(encuesta$`Dónde estás trabajando`) # en qué parte del país
unique(encuesta$`Trabajo de`)
table(encuesta$`Trabajo de`)
# unique(encuesta$Carrera)
```

### Filtros 

Se filtran las variables de interes.

```{r}
df1 <- encuesta[,c(1:5,24:31,35,47:49)]

library(lubridate)
class(df1$Timestamp)
ymd_hms(df1$Timestamp) # no se convierten a timestamp

```

Aplicar filtros: 

- Donde estás trabajando: GBA y CABA. 
- Tipo de contrato = Full-Time

```{r}
df1 %>%
  summary()

df2 <- df1 %>%
  filter(`Tipo de contrato` == "Full-Time")

df2 %>%
  head(5)

dim(df2)

glimpse(df2)
```

### Chequeo valores unicos y faltantes 

```{r}
tabla2 <- df2 %>% gather(.,
                         key   = Variables,
                         value = Valores) %>% 
  group_by(Variables) %>% 
  summarise(Valores.unicos = length(unique(Valores)), Valores.faltantes = sum(is.na(Valores)))
# ordeno la tabla por valores faltantes y luego unicos.
tabla2 %>% arrange(Valores.faltantes, Valores.unicos)
```

### Chequeo Outliers Univariados

```{r}
df2[,c(3,6:9,15:16)] %>%
  gather(.,
         key = Variables, 
         value = Valores) %>% 
  ggplot(aes(x = Variables, y = Valores)) + 
  geom_boxplot(alpha = 0.5) + 
  theme(axis.text.x = element_blank(), axis.ticks.x = element_blank()) +
  facet_wrap( ~ Variables, scales = "free")
```

Me quedé acá. Tendría que eliminar outliers y luego chequear correlación y demás!!! 

### Chequeo correlación

```{r}
library(corrr)
library(knitr)
library(kableExtra)
library(GGally)

# calculo matriz de correlacion para los registros completos (omitiendo faltantes) para variables numéricas con ambos métodos 

# pearson
matriz.correl.pe <- df2[,c(3,6:9,15:16)] %>% 
 correlate(use = "complete.obs", method = "pearson") %>% 
  shave() %>% 
  fashion()
matriz.correl.pe

# spearman
matriz.correl.sp <- df2[,c(3,6:9,15:16)] %>% 
 correlate(use = "complete.obs", method = "spearman") 
matriz.correl.sp

df2[,c(3,6:9,15:16)] %>%
   ggpairs(., 
        title = "Matriz de correlaciones",
        mapping = aes(colour = df2$`Dónde estás trabajando`))
```

Usemos el test de correlación de Spearman

```{r}
# cor.test(mtcars2$gear,mtcars2$drat, method = "pearson")
# cor.test(mtcars2$gear,mtcars2$drat, method = "spearman")
```

Noten que el test de Spearman ya no da tan significativo como el de Pearson


```{r}
data_anal <- df1 %>%
  filter(grepl("Anal", `Trabajo de`)) %>% 
  filter(`Tipo de contrato` == "Full-Time")
  
lm(`Salario mensual NETO (en tu moneda local)` ~ `Años de experiencia`, data_anal) %>%
  summary()


ggplot(data_anal, aes(x = `Años de experiencia`, y = `Salario mensual NETO (en tu moneda local)`)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red")

```

